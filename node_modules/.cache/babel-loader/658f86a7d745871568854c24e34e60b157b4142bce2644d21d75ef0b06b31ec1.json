{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright 2024 Google LLC. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VectorQuery = void 0;\nconst field_value_1 = require(\"../field-value\");\nconst path_1 = require(\"../path\");\nconst util_1 = require(\"../util\");\nconst query_util_1 = require(\"./query-util\");\nconst vector_query_snapshot_1 = require(\"./vector-query-snapshot\");\nconst query_profile_1 = require(\"../query-profile\");\n/**\n * A query that finds the documents whose vector fields are closest to a certain query vector.\n * Create an instance of `VectorQuery` with {@link Query.findNearest}.\n */\nclass VectorQuery {\n  /**\n   * @private\n   * @internal\n   */\n  constructor(_query, vectorField, queryVector, options) {\n    this._query = _query;\n    this.vectorField = vectorField;\n    this.queryVector = queryVector;\n    this.options = options;\n    this._queryUtil = new query_util_1.QueryUtil(_query._firestore, _query._queryOptions, _query._serializer);\n  }\n  /** The query whose results participants in the vector search. Filtering\n   * performed by the query will apply before the vector search.\n   **/\n  get query() {\n    return this._query;\n  }\n  /**\n   * @private\n   * @internal\n   */\n  get _rawVectorField() {\n    return typeof this.vectorField === 'string' ? this.vectorField : this.vectorField.toString();\n  }\n  /**\n   * @private\n   * @internal\n   */\n  get _rawQueryVector() {\n    return Array.isArray(this.queryVector) ? this.queryVector : this.queryVector.toArray();\n  }\n  /**\n   * Plans and optionally executes this vector search query. Returns a Promise that will be\n   * resolved with the planner information, statistics from the query execution (if any),\n   * and the query results (if any).\n   *\n   * @return A Promise that will be resolved with the planner information, statistics\n   *  from the query execution (if any), and the query results (if any).\n   */\n  async explain(options) {\n    if (options === undefined) {\n      options = {};\n    }\n    const {\n      result,\n      explainMetrics\n    } = await this._getResponse(options);\n    if (!explainMetrics) {\n      throw new Error('No explain results');\n    }\n    return new query_profile_1.ExplainResults(explainMetrics, result || null);\n  }\n  /**\n   * Executes this vector search query.\n   *\n   * @returns A promise that will be resolved with the results of the query.\n   */\n  async get() {\n    const {\n      result\n    } = await this._getResponse();\n    if (!result) {\n      throw new Error('No VectorQuerySnapshot result');\n    }\n    return result;\n  }\n  _getResponse(explainOptions) {\n    return this._queryUtil._getResponse(this, /*transactionOrReadTime*/undefined,\n    // VectorQuery cannot be retried with cursors as they do not support cursors yet.\n    /*retryWithCursor*/\n    false, explainOptions);\n  }\n  /**\n   * Internal streaming method that accepts an optional transaction ID.\n   *\n   * @param transactionId - A transaction ID.\n   * @private\n   * @internal\n   * @returns A stream of document results.\n   */\n  _stream(transactionId) {\n    return this._queryUtil._stream(this, transactionId, /*retryWithCursor*/false);\n  }\n  /**\n   * Internal method for serializing a query to its RunAggregationQuery proto\n   * representation with an optional transaction id.\n   *\n   * @private\n   * @internal\n   * @returns Serialized JSON for the query.\n   */\n  toProto(transactionOrReadTime, explainOptions) {\n    const queryProto = this._query.toProto(transactionOrReadTime);\n    const queryVector = Array.isArray(this.queryVector) ? new field_value_1.VectorValue(this.queryVector) : this.queryVector;\n    queryProto.structuredQuery.findNearest = {\n      limit: {\n        value: this.options.limit\n      },\n      distanceMeasure: this.options.distanceMeasure,\n      vectorField: {\n        fieldPath: path_1.FieldPath.fromArgument(this.vectorField).formattedName\n      },\n      queryVector: queryVector._toProto(this._query._serializer)\n    };\n    if (explainOptions) {\n      queryProto.explainOptions = explainOptions;\n    }\n    return queryProto;\n  }\n  /**\n   * Construct the resulting vector snapshot for this query with given documents.\n   *\n   * @private\n   * @internal\n   */\n  _createSnapshot(readTime, size, docs, changes) {\n    return new vector_query_snapshot_1.VectorQuerySnapshot(this, readTime, size, docs, changes);\n  }\n  /**\n   * Construct a new vector query whose result will start after To support stream().\n   * This now throws an exception because cursors are not supported from the backend for vector queries yet.\n   *\n   * @private\n   * @internal\n   * @returns Serialized JSON for the query.\n   */\n  startAfter(\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  ...fieldValuesOrDocumentSnapshot) {\n    throw new Error('Unimplemented: Vector query does not support cursors yet.');\n  }\n  /**\n   * Compares this object with the given object for equality.\n   *\n   * This object is considered \"equal\" to the other object if and only if\n   * `other` performs the same vector distance search as this `VectorQuery` and\n   * the underlying Query of `other` compares equal to that of this object\n   * using `Query.isEqual()`.\n   *\n   * @param other - The object to compare to this object for equality.\n   * @returns `true` if this object is \"equal\" to the given object, as\n   * defined above, or `false` otherwise.\n   */\n  isEqual(other) {\n    if (this === other) {\n      return true;\n    }\n    if (!(other instanceof VectorQuery)) {\n      return false;\n    }\n    if (!this.query.isEqual(other.query)) {\n      return false;\n    }\n    return this._rawVectorField === other._rawVectorField && (0, util_1.isPrimitiveArrayEqual)(this._rawQueryVector, other._rawQueryVector) && this.options.isEqual(other.options);\n  }\n}\nexports.VectorQuery = VectorQuery;","map":{"version":3,"names":["Object","defineProperty","exports","value","VectorQuery","field_value_1","require","path_1","util_1","query_util_1","vector_query_snapshot_1","query_profile_1","constructor","_query","vectorField","queryVector","options","_queryUtil","QueryUtil","_firestore","_queryOptions","_serializer","query","_rawVectorField","toString","_rawQueryVector","Array","isArray","toArray","explain","undefined","result","explainMetrics","_getResponse","Error","ExplainResults","get","explainOptions","_stream","transactionId","toProto","transactionOrReadTime","queryProto","VectorValue","structuredQuery","findNearest","limit","distanceMeasure","fieldPath","FieldPath","fromArgument","formattedName","_toProto","_createSnapshot","readTime","size","docs","changes","VectorQuerySnapshot","startAfter","fieldValuesOrDocumentSnapshot","isEqual","other","isPrimitiveArrayEqual"],"sources":["C:/Users/ATTA UR REHMAN/Music/Fida/Cupboard/node_modules/@google-cloud/firestore/build/src/reference/vector-query.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright 2024 Google LLC. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.VectorQuery = void 0;\nconst field_value_1 = require(\"../field-value\");\nconst path_1 = require(\"../path\");\nconst util_1 = require(\"../util\");\nconst query_util_1 = require(\"./query-util\");\nconst vector_query_snapshot_1 = require(\"./vector-query-snapshot\");\nconst query_profile_1 = require(\"../query-profile\");\n/**\n * A query that finds the documents whose vector fields are closest to a certain query vector.\n * Create an instance of `VectorQuery` with {@link Query.findNearest}.\n */\nclass VectorQuery {\n    /**\n     * @private\n     * @internal\n     */\n    constructor(_query, vectorField, queryVector, options) {\n        this._query = _query;\n        this.vectorField = vectorField;\n        this.queryVector = queryVector;\n        this.options = options;\n        this._queryUtil = new query_util_1.QueryUtil(_query._firestore, _query._queryOptions, _query._serializer);\n    }\n    /** The query whose results participants in the vector search. Filtering\n     * performed by the query will apply before the vector search.\n     **/\n    get query() {\n        return this._query;\n    }\n    /**\n     * @private\n     * @internal\n     */\n    get _rawVectorField() {\n        return typeof this.vectorField === 'string'\n            ? this.vectorField\n            : this.vectorField.toString();\n    }\n    /**\n     * @private\n     * @internal\n     */\n    get _rawQueryVector() {\n        return Array.isArray(this.queryVector)\n            ? this.queryVector\n            : this.queryVector.toArray();\n    }\n    /**\n     * Plans and optionally executes this vector search query. Returns a Promise that will be\n     * resolved with the planner information, statistics from the query execution (if any),\n     * and the query results (if any).\n     *\n     * @return A Promise that will be resolved with the planner information, statistics\n     *  from the query execution (if any), and the query results (if any).\n     */\n    async explain(options) {\n        if (options === undefined) {\n            options = {};\n        }\n        const { result, explainMetrics } = await this._getResponse(options);\n        if (!explainMetrics) {\n            throw new Error('No explain results');\n        }\n        return new query_profile_1.ExplainResults(explainMetrics, result || null);\n    }\n    /**\n     * Executes this vector search query.\n     *\n     * @returns A promise that will be resolved with the results of the query.\n     */\n    async get() {\n        const { result } = await this._getResponse();\n        if (!result) {\n            throw new Error('No VectorQuerySnapshot result');\n        }\n        return result;\n    }\n    _getResponse(explainOptions) {\n        return this._queryUtil._getResponse(this, \n        /*transactionOrReadTime*/ undefined, \n        // VectorQuery cannot be retried with cursors as they do not support cursors yet.\n        /*retryWithCursor*/ false, explainOptions);\n    }\n    /**\n     * Internal streaming method that accepts an optional transaction ID.\n     *\n     * @param transactionId - A transaction ID.\n     * @private\n     * @internal\n     * @returns A stream of document results.\n     */\n    _stream(transactionId) {\n        return this._queryUtil._stream(this, transactionId, \n        /*retryWithCursor*/ false);\n    }\n    /**\n     * Internal method for serializing a query to its RunAggregationQuery proto\n     * representation with an optional transaction id.\n     *\n     * @private\n     * @internal\n     * @returns Serialized JSON for the query.\n     */\n    toProto(transactionOrReadTime, explainOptions) {\n        const queryProto = this._query.toProto(transactionOrReadTime);\n        const queryVector = Array.isArray(this.queryVector)\n            ? new field_value_1.VectorValue(this.queryVector)\n            : this.queryVector;\n        queryProto.structuredQuery.findNearest = {\n            limit: { value: this.options.limit },\n            distanceMeasure: this.options.distanceMeasure,\n            vectorField: {\n                fieldPath: path_1.FieldPath.fromArgument(this.vectorField).formattedName,\n            },\n            queryVector: queryVector._toProto(this._query._serializer),\n        };\n        if (explainOptions) {\n            queryProto.explainOptions = explainOptions;\n        }\n        return queryProto;\n    }\n    /**\n     * Construct the resulting vector snapshot for this query with given documents.\n     *\n     * @private\n     * @internal\n     */\n    _createSnapshot(readTime, size, docs, changes) {\n        return new vector_query_snapshot_1.VectorQuerySnapshot(this, readTime, size, docs, changes);\n    }\n    /**\n     * Construct a new vector query whose result will start after To support stream().\n     * This now throws an exception because cursors are not supported from the backend for vector queries yet.\n     *\n     * @private\n     * @internal\n     * @returns Serialized JSON for the query.\n     */\n    startAfter(\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ...fieldValuesOrDocumentSnapshot) {\n        throw new Error('Unimplemented: Vector query does not support cursors yet.');\n    }\n    /**\n     * Compares this object with the given object for equality.\n     *\n     * This object is considered \"equal\" to the other object if and only if\n     * `other` performs the same vector distance search as this `VectorQuery` and\n     * the underlying Query of `other` compares equal to that of this object\n     * using `Query.isEqual()`.\n     *\n     * @param other - The object to compare to this object for equality.\n     * @returns `true` if this object is \"equal\" to the given object, as\n     * defined above, or `false` otherwise.\n     */\n    isEqual(other) {\n        if (this === other) {\n            return true;\n        }\n        if (!(other instanceof VectorQuery)) {\n            return false;\n        }\n        if (!this.query.isEqual(other.query)) {\n            return false;\n        }\n        return (this._rawVectorField === other._rawVectorField &&\n            (0, util_1.isPrimitiveArrayEqual)(this._rawQueryVector, other._rawQueryVector) &&\n            this.options.isEqual(other.options));\n    }\n}\nexports.VectorQuery = VectorQuery;\n//# sourceMappingURL=vector-query.js.map"],"mappings":"AAAA,YAAY;;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,WAAW,GAAG,KAAK,CAAC;AAC5B,MAAMC,aAAa,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AAC/C,MAAMC,MAAM,GAAGD,OAAO,CAAC,SAAS,CAAC;AACjC,MAAME,MAAM,GAAGF,OAAO,CAAC,SAAS,CAAC;AACjC,MAAMG,YAAY,GAAGH,OAAO,CAAC,cAAc,CAAC;AAC5C,MAAMI,uBAAuB,GAAGJ,OAAO,CAAC,yBAAyB,CAAC;AAClE,MAAMK,eAAe,GAAGL,OAAO,CAAC,kBAAkB,CAAC;AACnD;AACA;AACA;AACA;AACA,MAAMF,WAAW,CAAC;EACd;AACJ;AACA;AACA;EACIQ,WAAWA,CAACC,MAAM,EAAEC,WAAW,EAAEC,WAAW,EAAEC,OAAO,EAAE;IACnD,IAAI,CAACH,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,UAAU,GAAG,IAAIR,YAAY,CAACS,SAAS,CAACL,MAAM,CAACM,UAAU,EAAEN,MAAM,CAACO,aAAa,EAAEP,MAAM,CAACQ,WAAW,CAAC;EAC7G;EACA;AACJ;AACA;EACI,IAAIC,KAAKA,CAAA,EAAG;IACR,OAAO,IAAI,CAACT,MAAM;EACtB;EACA;AACJ;AACA;AACA;EACI,IAAIU,eAAeA,CAAA,EAAG;IAClB,OAAO,OAAO,IAAI,CAACT,WAAW,KAAK,QAAQ,GACrC,IAAI,CAACA,WAAW,GAChB,IAAI,CAACA,WAAW,CAACU,QAAQ,CAAC,CAAC;EACrC;EACA;AACJ;AACA;AACA;EACI,IAAIC,eAAeA,CAAA,EAAG;IAClB,OAAOC,KAAK,CAACC,OAAO,CAAC,IAAI,CAACZ,WAAW,CAAC,GAChC,IAAI,CAACA,WAAW,GAChB,IAAI,CAACA,WAAW,CAACa,OAAO,CAAC,CAAC;EACpC;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAMC,OAAOA,CAACb,OAAO,EAAE;IACnB,IAAIA,OAAO,KAAKc,SAAS,EAAE;MACvBd,OAAO,GAAG,CAAC,CAAC;IAChB;IACA,MAAM;MAAEe,MAAM;MAAEC;IAAe,CAAC,GAAG,MAAM,IAAI,CAACC,YAAY,CAACjB,OAAO,CAAC;IACnE,IAAI,CAACgB,cAAc,EAAE;MACjB,MAAM,IAAIE,KAAK,CAAC,oBAAoB,CAAC;IACzC;IACA,OAAO,IAAIvB,eAAe,CAACwB,cAAc,CAACH,cAAc,EAAED,MAAM,IAAI,IAAI,CAAC;EAC7E;EACA;AACJ;AACA;AACA;AACA;EACI,MAAMK,GAAGA,CAAA,EAAG;IACR,MAAM;MAAEL;IAAO,CAAC,GAAG,MAAM,IAAI,CAACE,YAAY,CAAC,CAAC;IAC5C,IAAI,CAACF,MAAM,EAAE;MACT,MAAM,IAAIG,KAAK,CAAC,+BAA+B,CAAC;IACpD;IACA,OAAOH,MAAM;EACjB;EACAE,YAAYA,CAACI,cAAc,EAAE;IACzB,OAAO,IAAI,CAACpB,UAAU,CAACgB,YAAY,CAAC,IAAI,EACxC,yBAA0BH,SAAS;IACnC;IACA;IAAoB,KAAK,EAAEO,cAAc,CAAC;EAC9C;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,OAAOA,CAACC,aAAa,EAAE;IACnB,OAAO,IAAI,CAACtB,UAAU,CAACqB,OAAO,CAAC,IAAI,EAAEC,aAAa,EAClD,mBAAoB,KAAK,CAAC;EAC9B;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,OAAOA,CAACC,qBAAqB,EAAEJ,cAAc,EAAE;IAC3C,MAAMK,UAAU,GAAG,IAAI,CAAC7B,MAAM,CAAC2B,OAAO,CAACC,qBAAqB,CAAC;IAC7D,MAAM1B,WAAW,GAAGW,KAAK,CAACC,OAAO,CAAC,IAAI,CAACZ,WAAW,CAAC,GAC7C,IAAIV,aAAa,CAACsC,WAAW,CAAC,IAAI,CAAC5B,WAAW,CAAC,GAC/C,IAAI,CAACA,WAAW;IACtB2B,UAAU,CAACE,eAAe,CAACC,WAAW,GAAG;MACrCC,KAAK,EAAE;QAAE3C,KAAK,EAAE,IAAI,CAACa,OAAO,CAAC8B;MAAM,CAAC;MACpCC,eAAe,EAAE,IAAI,CAAC/B,OAAO,CAAC+B,eAAe;MAC7CjC,WAAW,EAAE;QACTkC,SAAS,EAAEzC,MAAM,CAAC0C,SAAS,CAACC,YAAY,CAAC,IAAI,CAACpC,WAAW,CAAC,CAACqC;MAC/D,CAAC;MACDpC,WAAW,EAAEA,WAAW,CAACqC,QAAQ,CAAC,IAAI,CAACvC,MAAM,CAACQ,WAAW;IAC7D,CAAC;IACD,IAAIgB,cAAc,EAAE;MAChBK,UAAU,CAACL,cAAc,GAAGA,cAAc;IAC9C;IACA,OAAOK,UAAU;EACrB;EACA;AACJ;AACA;AACA;AACA;AACA;EACIW,eAAeA,CAACC,QAAQ,EAAEC,IAAI,EAAEC,IAAI,EAAEC,OAAO,EAAE;IAC3C,OAAO,IAAI/C,uBAAuB,CAACgD,mBAAmB,CAAC,IAAI,EAAEJ,QAAQ,EAAEC,IAAI,EAAEC,IAAI,EAAEC,OAAO,CAAC;EAC/F;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIE,UAAUA;EACV;EACA,GAAGC,6BAA6B,EAAE;IAC9B,MAAM,IAAI1B,KAAK,CAAC,2DAA2D,CAAC;EAChF;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI2B,OAAOA,CAACC,KAAK,EAAE;IACX,IAAI,IAAI,KAAKA,KAAK,EAAE;MAChB,OAAO,IAAI;IACf;IACA,IAAI,EAAEA,KAAK,YAAY1D,WAAW,CAAC,EAAE;MACjC,OAAO,KAAK;IAChB;IACA,IAAI,CAAC,IAAI,CAACkB,KAAK,CAACuC,OAAO,CAACC,KAAK,CAACxC,KAAK,CAAC,EAAE;MAClC,OAAO,KAAK;IAChB;IACA,OAAQ,IAAI,CAACC,eAAe,KAAKuC,KAAK,CAACvC,eAAe,IAClD,CAAC,CAAC,EAAEf,MAAM,CAACuD,qBAAqB,EAAE,IAAI,CAACtC,eAAe,EAAEqC,KAAK,CAACrC,eAAe,CAAC,IAC9E,IAAI,CAACT,OAAO,CAAC6C,OAAO,CAACC,KAAK,CAAC9C,OAAO,CAAC;EAC3C;AACJ;AACAd,OAAO,CAACE,WAAW,GAAGA,WAAW","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}